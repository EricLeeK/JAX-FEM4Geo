# Drucker-Prager 塑性实现验证报告

**日期：** 2025-12-22
**项目：** FEM-JAX-GEO (Drucker-Prager 塑性)
**作者：** [Lishiyao]

## 1. 目标
本实验的主要目标是验证 `jax-fem` 框架内 Drucker-Prager 塑性实现的正确性。通过将有限元法 (FEM) 结果与半解析的“本构驱动程序”（验证脚本）进行对比来实现，该脚本解决了理想单轴应力条件下单个材料点的返回映射算法。

此外，还进行了**可微性冒烟测试**，以验证该实现是否支持通过 JAX 进行自动微分 (AD)，从而实现基于梯度的优化。

## 2. 方法论

### 2.1 材料参数
FEM 仿真和验证驱动程序均使用完全相同的材料参数：
*   **杨氏模量 ($E$):** 70,000 MPa (70 GPa)
*   **泊松比 ($\nu$):** 0.3
*   **摩擦系数 ($\alpha$):** 0.3
*   **黏聚力 ($k$):** 250.0 MPa
*   **顶点正则化 ($a$):** 2.5 MPa ($0.01 \times k$)

### 2.2 仿真设置

#### 有限元模型 (`drucker_prager_plasticity.py`)
*   **几何结构：** $10 \times 10 \times 10$ mm 立方体。
*   **网格：** $5 \times 5 \times 5$ HEX8 单元（125 个单元，216 个节点）。
*   **边界条件：**
    *   底部 ($z=0$): $u_z = 0$。
    *   顶部 ($z=10$): 指定位移 $u_z$（压缩）。
    *   侧向边界：自由（自然边界条件），近似于整体材料的单轴应力状态。
*   **加载：** 循环加载：$0 \to -0.15$ mm $\to 0$ mm（压缩后卸载）。
*   **输出：** 体积平均应力 ($\sigma_{zz}$) vs. 工程应变 ($\epsilon_{zz} = \delta / L_z$)。

#### 本构驱动程序 (`verification_dp.py`)
*   **方法：** 局部求解非线性本构方程。
*   **约束：** 通过迭代寻找给定垂直应变增量所需的侧向应变，强制执行 $\sigma_{xx} = \sigma_{yy} = 0$（单轴应力）。
*   **算法：** 带有双曲顶点正则化的弹性预测 - 塑性修正（返回映射）。

## 3. 结果

### 3.1 定量比较
分别计算了初始弹性区域和塑性加载区域的应力-应变曲线斜率。

| 指标 | 验证驱动程序 | FEM 仿真 | 差异 | 误差 (%) |
| :--- | :--- | :--- | :--- | :--- |
| **弹性模量** | 70,000.00 MPa | 70,000.00 MPa | 0.00 MPa | 0.00% |
| **塑性切线模量** | 58,983.23 MPa | 58,983.23 MPa | 0.00 MPa | 0.00% |

*注意：完全匹配表明 FEM 公式在单元上正确集成了本构模型。*

### 3.2 可视化比较
两种方法的应力-应变曲线在下图叠加显示。

![对比图](/home/ericleek/fem-jax-geo/results/2025-12-22_verification/comparison_plot.png)
*(见 `study-fold/comparison_plot.png`)*

FEM 数据点（蓝色圆圈）与验证驱动程序曲线（红线）完美对齐，验证了在弹性阶段和塑性阶段（包括由于顶点正则化导致的屈服处平滑过渡）实现的正确性。

### 3.3 原始数据文件
*   **FEM 结果：** `/home/ericleek/fem-jax-geo/results/2025-12-22_verification/fem_data.csv`
*   **验证结果：** `/home/ericleek/fem-jax-geo/results/2025-12-22_verification/verification_data.csv`

## 4. 可微性验证与稳定性分析

进行了梯度测试 (`study-fold/grad_test_dp.py`)，以检查是否可以通过 JAX 的自动微分 (AD) 恢复设计参数 (E, k)。

### 4.1 线性区域的成功
当位移较小 ($10^{-5}$ mm) 以确保材料保持在弹性区域时：
*   **AD 梯度：** 与有限差分 (FD) 梯度完美匹配。
*   **相对误差：** $\approx 10^{-19}$。
*   **结论：** AD 流水线连接正确；JAX 可以追踪自定义的 `Problem` 类和本构逻辑。

### 4.2 塑性区域的收敛失败
当增大位移以引发塑性（$> 0.05$ mm）时，**伴随求解器未能收敛** (`PETSc linear solver failed to converge`)。

#### 4.2.1 根本原因分析
1.  **一致切线奇异性：** 在率无关塑性中，连续切线算子在弹塑性边界处变得不连续。算法一致切线（用于雅可比矩阵）可能变得病态或奇异，特别是在屈服面的“拐角”附近或剧烈卸载期间。
2.  **JAX `vjp` 稳定性：** `stress_return_map` 使用 `np.where` 在弹性分支和塑性分支之间切换。虽然 JAX 处理控制流，但刚度的突变会产生一个“刚性”伴随问题。
3.  **线性求解器敏感性：** 默认的线性求解器（如带有 ILU 的 GMRES/BiCGStab）难以处理 3D 塑性切线矩阵的不定性或高度不对称性。

#### 4.2.2 建议的解决方案
为了在塑性区域实现稳定的基于梯度的优化，建议采取以下策略：

1.  **增强正则化：**
    *   增加顶点平滑参数 $a$。
    *   引入**黏塑性**（率相关性），这从根本上正则化了切线算子，使其在各处均适定。

2.  **鲁棒的伴随求解器：**
    *   对于伴随问题，通过 PETSc 切换到直接求解器（如 MUMPS, SuperLU），因为迭代求解器在塑性切线上容易停滞。
    *   使用带有更强预条件子（如 `asm` 或 `gamg`）的 `gmres`。

3.  **可微平滑：**
    *   使用平滑的 sigmoid 类转换函数（如 `jax.nn.sigmoid`）替换硬性的 `np.where` 切换，以在屈服面边界提供非零梯度。

## 5. 结论
`jax-fem` 中实现的 `DruckerPragerPlasticity` 类已成功通过**正向仿真验证**。结果表明：
1.  **弹性响应正确：** 刚度符合各向同性线性弹性理论。
2.  **屈服与流动正确：** 塑性硬化斜率和屈服点与本构驱动程序的理论预测一致。
3.  **数值稳定性（正向）：** 求解器通过正则化屈服面成功收敛了加载和卸载循环。

**建议：** 尽管正向模型是正确的，但**涉及深层塑性变形的基于梯度的优化需要进一步稳定**伴随问题（例如通过黏塑性正则化或直接线性求解器）。